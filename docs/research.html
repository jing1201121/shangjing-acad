<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Research – Jing Shang</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f93c2b1f3f0577f377aefa4848a86a36.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Jing Shang</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./research.html" aria-current="page"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-datasets" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Datasets</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-datasets">    
        <li>
    <a class="dropdown-item" href="./dataset.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/cryptocurrency_schema.html">
 <span class="dropdown-text">Cryptocurrency Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/onchain_metrics_schema.html">
 <span class="dropdown-text">On-chain Metrics Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/market_structure_schema.html">
 <span class="dropdown-text">Market Structure Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/proposal_dataset_schema.html">
 <span class="dropdown-text">Proposal Dataset Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/client_dev_activity_schema.html">
 <span class="dropdown-text">Client Development Activity Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/token_supply_knowledge_graph_schema.html">
 <span class="dropdown-text">Token Supply Knowledge Graph Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/staking_metrics_schema_v2.html">
 <span class="dropdown-text">Staking Metrics Schema</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/block_level_economic_activity_dataset.html">
 <span class="dropdown-text">Block-level Economic Activity Dataset</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datasets/ai_publications_dataset.html">
 <span class="dropdown-text">AI Publications Dataset</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./CV.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./other.html"> 
<span class="menu-text">Other</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Below are my major research projects during my <strong>Master’s</strong> and <strong>Bachelor’s</strong> studies.</p>
<section id="master-research-projects-pku" class="level2">
<h2 data-anchor-id="master-research-projects-pku">Master Research Projects (PKU)</h2>
<section id="innovation-structure-and-revenue-distribution-in-blockchain-open-source-ecosystems" class="level3">
<h3 data-anchor-id="innovation-structure-and-revenue-distribution-in-blockchain-open-source-ecosystems">Innovation Structure and Revenue Distribution in Blockchain Open-Source Ecosystems</h3>
<p><em>Principal Researcher</em><br>
<em>Working in Progress</em><br>
<strong>Supervisor:</strong> <a href="https://ciefr.pku.edu.cn/gywm/sztd/qzjs/7ff78cb582684f71be56b6d41f4048dc.htm">Mingxing Liu</a> (Prof., CIEFR, Peking University)</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>This study examines how blockchain-based open-source ecosystems generate sustainable returns in the absence of traditional property rights protection and centralized coordination. The long-standing vitality of open-source innovation challenges the classic “public-goods paradox,” while the introduction of token economies provides measurable and traceable channels through which innovation activities may be rewarded. Using Ethereum and Solana as representative cases, the study integrates GitHub developer activity with on-chain economic data to analyze the structural relationship between innovation and revenue distribution within blockchain ecosystems.</p>
<p>Building on the innovation process of blockchain networks and a layered technological stack, my current analysis differentiates protocol-layer from application-layer innovation. Preliminary findings indicate a cyclical dynamic in which demand-driven and supply-driven forces alternate in shaping innovation intensity. During market downturns, ecosystems tend to rely on application-layer innovation to stimulate user demand; during market expansions, rising activity and transaction volume create supply-side pressure that pushes protocol developers to advance scalability- and performance-oriented foundational innovation. As the dominant source of innovation shifts across phases, the structure of value creation and revenue distribution appears to reorganize correspondingly.</p>
<p>The core objective of this study is to identify how innovation at different layers of the blockchain stack receives economic rewards, thereby enabling the open-source ecosystem to sustain itself. By linking developer behavior with token-driven value flows, the study provides new empirical grounding and theoretical insight into innovation incentives, value allocation, and system evolution in tokenized open-source environments.</p>
</details>
<hr>
</section>
<section id="reframing-money-blockchain-native-tokens-as-endogenous-drivers-of-innovation-and-growth-in-decentralized-economies" class="level3">
<h3 data-anchor-id="reframing-money-blockchain-native-tokens-as-endogenous-drivers-of-innovation-and-growth-in-decentralized-economies">Reframing Money: Blockchain-Native Tokens as Endogenous Drivers of Innovation and Growth in Decentralized Economies</h3>
<p><em>In cooperation with <a href="https://facultyprofiles.hkust.edu.hk/profiles.php?profile=dong-zhang-dongzhang#publications">Dong Zhang</a> (Asst. Prof., Division of Social Science, HKUST)</em><br>
<em>Working Paper</em>, 2025<br>
<strong>Supervisor:</strong> <a href="https://ciefr.pku.edu.cn/gywm/sztd/qzjs/7ff78cb582684f71be56b6d41f4048dc.htm">Mingxing Liu</a> (Prof., CIEFR, Peking University)</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>This project reframes blockchain-native tokens not merely as financial instruments but as endogenous drivers of innovation and economic expansion in decentralized ecosystems. Existing research often evaluates cryptocurrencies through the traditional functions of money, overlooking their capacity to act as productive capital that coordinates and mobilizes ecosystem growth. This study argues that decentralized, permissionless tokens operate through a mechanism analogous to Schumpeter’s credit-driven innovation cycle, whereby credit creation fuels entrepreneurial experimentation and technological advancement.</p>
<p>We term this dynamic the <strong>Productive Deflationary Token Regime</strong>: by channeling seigniorage toward ecosystem expanders and maintaining incentive stability through deflationary token design, blockchain networks can sustain innovation without relying on state authority or centralized credit issuance. This mechanism supports decentralized, endogenous growth, offering a new perspective on how tokenized systems organize production, reward innovation, and generate long-run economic dynamism.</p>
</details>
<hr>
</section>
<section id="returnee-scientists-academic-performance-and-network-position-a-case-study-of-a-national-key-laboratory-in-information-science" class="level3">
<h3 data-anchor-id="returnee-scientists-academic-performance-and-network-position-a-case-study-of-a-national-key-laboratory-in-information-science">Returnee Scientists’ Academic Performance and Network Position: A Case Study of a National Key Laboratory in Information Science</h3>
<p><em>Principal Researcher</em><br>
<em>Final Project for the course Advanced Econometrics</em>, 2024<br>
<strong>Supervisor:</strong> <a href="https://www.gse.pku.edu.cn/szdw/jxkyry/jyjjyglx/132907.htm">Qiong Zhu</a> (Asst. Prof., Peking University)</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>Drawing on CV information and Scopus publication records for researchers in China’s information-science State Key Laboratories (2016–2021), this study constructs annual co-authorship networks and applies social network analysis to compare the academic performance and collaborative positions of returnee and domestic scholars. Empirically, returnees exhibit higher publication output, greater international collaboration, and higher citation impact—patterns particularly pronounced within CAS-affiliated laboratories. Network evidence shows that returnees in CAS labs tend to occupy peripheral or fragmented positions and rely more on overseas-oriented ties, whereas returnees in university laboratories integrate more readily into core research communities and more frequently serve as bridging actors. Consistently lower clustering coefficients but higher betweenness centrality among returnees highlight their distinctive role as connectors linking domestic and global scientific networks.</p>
</details>
<hr>
</section>
<section id="unwilling-or-unable-to-marry-marriage-intentions-among-the-second-generation-of-internal-migrants" class="level3">
<h3 data-anchor-id="unwilling-or-unable-to-marry-marriage-intentions-among-the-second-generation-of-internal-migrants">Unwilling or Unable to Marry? Marriage Intentions among the Second Generation of Internal Migrants</h3>
<p><em>In collaboration with</em> <a href="https://www.gse.pku.edu.cn/szdw/jxkyry/jyglyzcx/32236.htm">Ran Zhang</a> <em>(Assoc. Prof., PKU)</em>, Mingyue Yang, Sihong Ren, <a href="https://ciefr.pku.edu.cn/gywm/sztd/qzjs/84f2f9a1b4ca46a696d89e325796c54d.htm">Yingquan Song</a> <em>(Assoc. R., CIEFR)</em><br>
<strong>Accepted:</strong> <em>Youth Studies</em> (forthcoming), 2024<br>
<strong>Funding:</strong> National Natural Science Foundation of China (Grant No.&nbsp;71110107028)</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>China’s second-generation migrants have reached marriageable age, and their mobility experiences broaden life horizons while reshaping marital choices. Traditional norms are disrupted by the individualistic values of destination cities, leading some to develop a preference for not marrying. For those who wish to marry, disadvantaged socioeconomic status and extended career transitions often delay marriage, producing a “cannot marry” dilemma. For men in particular, non-marriage frequently reflects difficulties in cross-regional matching and exclusion from the home-region marriage market.</p>
</details>
<hr>
</section>
</section>
<section id="bachelor-research-projects-ucass" class="level2">
<h2 data-anchor-id="bachelor-research-projects-ucass">Bachelor Research Projects (UCASS)</h2>
<section id="the-impact-of-enterprise-digital-transformation-on-the-quality-of-accounting-information" class="level3">
<h3 data-anchor-id="the-impact-of-enterprise-digital-transformation-on-the-quality-of-accounting-information">The Impact of Enterprise Digital Transformation on the Quality of Accounting Information</h3>
<p><em>Principal Researcher</em><br>
<em>Graduation Thesis (Bachelor of Management)</em>, Excellent final assessment, 2023<br>
<strong>Supervisor:</strong> <a href="https://bs.ucass.edu.cn/info/1191/3126.htm">Yanru Wang</a> (Prof., UCASS)</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>With the emergence of “ABCD” technologies and their integration into the real economy, digital transformation has become essential for firms. Using 2011–2021 Shanghai–Shenzhen A-share listed companies, this study examines how digital transformation affects accounting information quality and tests internal control and information asymmetry as underlying mechanisms. Results show a dual impact: digital transformation enhances internal control and improves information quality, yet it also heightens investor disagreement and market asymmetry, harming information quality. The effects differ by ownership type and firms’ Internet attributes, offering new insights into accounting information quality in the digital economy era.</p>
</details>
<hr>
</section>
<section id="high-speed-railway-expansion-human-capital-mobility-and-industrial-structure-upgrading" class="level3">
<h3 data-anchor-id="high-speed-railway-expansion-human-capital-mobility-and-industrial-structure-upgrading">High-Speed Railway Expansion, Human Capital Mobility, and Industrial Structure Upgrading</h3>
<p><em>Principal Researcher</em><br>
<em>Graduation Thesis (Bachelor of Economics)</em>, Excellent final assessment, 2023<br>
<strong>Supervisor:</strong> <a href="https://fae.ucass.edu.cn/info/1128/1591.htm">Yaowu Wu</a>（Researcher, IPLE, CASS）</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>Using census microdata from 2010 and 2015 together with HHSR opening records, this study employs a <strong>DID</strong> design to examine how high-speed rail affects human capital flows across Chinese prefecture-level cities. HSR openings significantly enhance interregional mobility, help HSR cities attract skilled workers, and raise overall human capital levels—especially within the tertiary sector, supporting industrial upgrading. Regionally, HSR drives technology-intensive upgrading in the Bohai Rim and capital-intensive upgrading in the Yangtze River Delta, with no significant effect in the Pearl River Delta. These findings provide policy-relevant evidence on how HSR reshapes human capital allocation and industrial transformation.</p>
</details>
<hr>
</section>
<section id="leader-of-integrated-revitalization-of-alkaline-tomato-industry" class="level3">
<h3 data-anchor-id="leader-of-integrated-revitalization-of-alkaline-tomato-industry">Leader of Integrated Revitalization of Alkaline Tomato Industry</h3>
<p><em>Second Author</em><br>
<strong>Gold Prize</strong>, <em>“Challenge Cup” Entrepreneurship Competition</em>, 2022<br>
<strong>Supervisors:</strong> <a href="https://sipe.ucass.edu.cn/info/1151/1621.htm">Bin Zhang</a> (IWEP, CASS); <a href="https://bs.ucass.edu.cn/info/1191/3126.htm">Yanru Wang</a> (Prof.,UCASS)</p>
<details>
<summary>
<strong>Abstract (click to expand)</strong>
</summary>
<p>This project develops an integrated revitalization model for the alkaline tomato industry by combining agricultural economics, IoT-enabled automation, and data-driven management. It builds a digital agricultural value chain that connects scientific knowledge, technological tools, and sales services to support sustainable rural development. The project produced three software systems registered with the China National Copyright Administration (CNCA):<br>
- <strong>Agricultural Economic Information Integrated Management System V1.0</strong> (2021SR1437268)<br>
- <strong>IoT-based Agricultural Irrigation Automation Control Platform V1.0</strong> (2021SR1429282)<br>
- <strong>Intelligent Agriculture Crop Production Automation Detection Software V1.0</strong> (2021SR1437195)</p>
</details>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>